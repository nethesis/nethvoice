#!/usr/bin/env python

#
# Copyright (C) 2023 Nethesis S.r.l.
# SPDX-License-Identifier: GPL-3.0-or-later
#

import json
import sys

import agent

# get old environment from action
request = json.load(sys.stdin)
old_envs = request['environment']

# list of variables to restore
restore_envs = [
    'AMPASTERISKWEBGROUP',
    'AMPASTERISKWEBUSER',
    'AMPDBENGINE',
    'AMPDBHOST',
    'AMPDBNAME',
    'AMPDBPASS',
    'AMPDBUSER',
    'AMPMGRPASS',
    'AMPMGRUSER',
    'APACHE_RUN_GROUP',
    'APACHE_RUN_USER',
    'BRAND_APPID',
    'BRAND_DOCS',
    'BRAND_NAME',
    'BRAND_SITE',
    'CDRDBHOST',
    'CDRDBNAME',
    'CDRDBPASS',
    'CDRDBUSER',
    'CONFERENCE_JITSI_URL',
    'FLEXISIP_LOG_LEVEL',
    'ICEIGNORE',
    'JANUS_ADMIN_SECRET',
    'JANUS_DEBUG_LEVEL',
    'JANUS_RTPEND',
    'JANUS_RTPSTART',
    'MARIADB_ROOT_PASSWORD',
    'NETHCTI_ALERTS',
    'NETHCTI_AMI_PASSWORD',
    'NETHCTI_AUTHENTICATION_ENABLED',
    'NETHCTI_AUTOC2C',
    'NETHCTI_CDR_SCRIPT',
    'NETHCTI_CDR_SCRIPT_CALL_IN',
    'NETHCTI_CDR_SCRIPT_TIMEOUT',
    'NETHCTI_DB_HOST',
    'NETHCTI_DB_PASSWORD',
    'NETHCTI_DB_USER',
    'NETHCTI_JABBER_DOMAIN',
    'NETHCTI_JABBER_URL',
    'NETHCTI_LOG_LEVEL',
    'NETHCTI_PREFIX',
    'NETHCTI_TRUNKS_EVENTS',
    'NETHCTI_UI_COMPANY_NAME',
    'NETHCTI_UI_COMPANY_URL',
    'NETHCTI_UI_HOST',
    'NETHCTI_UI_PRODUCT_NAME',
    'NETHCTI_UNAUTHE_CALL',
    'NETHCTI_UNAUTHE_CALL_IP',
    'NETHVOICE_HOST',
    'NETHVOICE_HOST_LOCAL_NETWORKS',
    'NETHVOICE_LDAP_BASE',
    'NETHVOICE_LDAP_HOST',
    'NETHVOICE_LDAP_PASS',
    'NETHVOICE_LDAP_SCHEMA',
    'NETHVOICE_LDAP_USER',
    'NETHVOICE_PROXY_FQDN',
    'NETHVOICE_USER_PORTAL_USERNAME',
    'NETHVOICE_USER_PORTAL_USERNAME',
    'NETHVOICESECRETKEY',
    'PHONEBOOK_DB_HOST',
    'PHONEBOOK_DB_NAME',
    'PHONEBOOK_DB_PASS',
    'PHONEBOOK_DB_USER',
    'PHONEBOOK_LDAP_LIMIT',
    'PHONEBOOK_LDAP_PASS',
    'PHONEBOOK_LDAP_USER',
    'PREV_NETHVOICE_CTI_SERVER_IMAGE',
    'PREV_NETHVOICE_CTI_UI_IMAGE',
    'PREV_NETHVOICE_FLEXISIP_IMAGE',
    'PREV_NETHVOICE_FREEPBX_IMAGE',
    'PREV_NETHVOICE_JANUS_IMAGE',
    'PREV_NETHVOICE_MARIADB_IMAGE',
    'PREV_NETHVOICE_PHONEBOOK_IMAGE',
    'PREV_NETHVOICE_REPORTS_API_IMAGE',
    'PREV_NETHVOICE_REPORTS_UI_IMAGE',
    'PREV_NETHVOICE_TANCREDI_IMAGE',
    'REPORTS_API_KEY',
    'REPORTS_INTERNATIONAL_PREFIX',
    'REPORTS_PASSWORD',
    'REPORTS_SECRET',
    'NETHVOICE_HOST_LOCAL_NETWORKS',
    'SUBSCRIPTION_SYSTEMID',
    'SUBSCRIPTION_SECRET',
    'NETHCTI_PREFIX',
    'NETHCTI_AUTOC2C',
    'NETHCTI_TRUNKS_EVENTS',
    'NETHCTI_ALERTS',
    'NETHCTI_AUTHENTICATION_ENABLED',
    'NETHCTI_UNAUTHE_CALL',
    'NETHCTI_UNAUTHE_CALL_IP',
    'NETHCTI_JABBER_URL',
    'NETHCTI_JABBER_DOMAIN',
    'NETHCTI_CDR_SCRIPT',
    'NETHCTI_CDR_SCRIPT_TIMEOUT',
    'NETHCTI_CDR_SCRIPT_CALL_IN',
    'NETHCTI_LOG_LEVEL',
    'CONFERENCE_JITSI_URL',
    'BRAND_APPID',
    'NETHCTI_UI_PRODUCT_NAME',
    'NETHCTI_UI_COMPANY_NAME',
    'NETHCTI_UI_COMPANY_URL',
    'USER_DOMAIN',
    'REPORTS_UI_APP_NAME',
    'REPORTS_UI_COMPANY_NAME',
    'REPORTS_UI_HELP_URL',
    'STUNSERVER',
    'SUBSCRIPTION_SECRET',
    'SUBSCRIPTION_SYSTEMID',
    'TANCREDI_STATIC_TOKEN',
    'TIMEZONE',
    'TRAEFIK_HTTP2HTTPS',
    'TRAEFIK_LETS_ENCRYPT',
    'USER_DOMAIN',
]

for env in restore_envs:
    if env in old_envs:
        agent.set_env(env, old_envs[env])
